{{ define "main" }}
<article class="quiz-page">
  <div class="quiz-header">
    <h1>{{ .Title }}</h1>
    {{ .Content }}
  </div>

  {{ $qs := .Params.questions }}
  {{ if not $qs }}
    <p><em>No questions defined.</em></p>
  {{ else }}

  <div class="quiz-stats">
    <span><strong>Total Questions:</strong> {{ len $qs }}</span>
    <span><strong>Time:</strong> Unlimited</span>
  </div>

  <div class="quiz">
    {{ range $idx, $q := $qs }}
    <div class="question question-{{ $q.type }}"
         data-question="{{ $idx }}"
         data-type="{{ $q.type }}"
         data-answer="{{ if eq $q.type "single" }}{{ $q.answer }}{{ else }}{{ delimit $q.answer "," }}{{ end }}"
         data-points="{{ default 1 $q.points }}">

      <div class="question-header">
        <span class="question-type">
          {{ if eq $q.type "single" }}Single Choice{{ else }}Multiple Choice{{ end }}
        </span>
      </div>

      <div class="stem">
        {{ $q.text | markdownify }}
      </div>

      {{ if eq $q.type "single" }}
        <ul class="choices">
          {{ range $i, $c := $q.choices }}
          <li>
            <label>
              <input type="radio" name="q{{ $idx }}" value="{{ $i }}">
              <span>{{ $c }}</span>
            </label>
          </li>
          {{ end }}
        </ul>
      {{ else if eq $q.type "multi" }}
        <ul class="choices">
          {{ range $i, $c := $q.choices }}
          <li>
            <label>
              <input type="checkbox" name="q{{ $idx }}" value="{{ $i }}">
              <span>{{ $c }}</span>
            </label>
          </li>
          {{ end }}
        </ul>
      {{ else }}
        <p><em>Invalid question type "{{ $q.type }}".</em></p>
      {{ end }}

      {{ if $q.hint }}
        <button class="hint-button" onclick="toggleHint({{ $idx }})">Hint</button>
        <div class="hint" id="hint{{ $idx }}">
          <strong>ðŸ’¡ Hint:</strong> {{ $q.hint | markdownify }}
        </div>
      {{ end }}

      <div class="answer" id="answer{{ $idx }}">
        {{ if eq $q.type "single" }}
          <p><strong>âœ… Correct answer:</strong> {{ index $q.choices $q.answer }}</p>
        {{ else if eq $q.type "multi" }}
          <p><strong>âœ… Correct answers:</strong>
            {{ range $i, $a := $q.answer }}
              {{ index $q.choices $a }}{{ if ne $i (sub (len $q.answer) 1) }}, {{ end }}
            {{ end }}
          </p>
        {{ end }}
        <div class="result-message" id="result{{ $idx }}"></div>
      </div>
    </div>
    {{ end }}
  </div>
  <!-- QUESTIONS END -->

  <div class="quiz-footer">
    <button onclick="submitAnswers()">Submit</button>
    <button class="reset-btn" onclick="resetSelections()">Reset</button>

    <div class="score-display" id="scoreDisplay">
      <div style="font-size: 24px; margin-bottom: 10px;">
        Score: <span id="score">0</span> / <span id="total">0</span> (<span id="percentage">0</span>%)
      </div>
      <div class="score-breakdown">
        <span>Points Earned: <span id="scorePoints">0</span></span>
        <span>Total Points: <span id="maxPoints">0</span></span>
        <span>Questions: {{ len $qs }}</span>
      </div>
    </div>
  </div>
  
  {{ $js := resources.Get "js/quiz.js" | js.Build | minify | fingerprint }}
  <script src="{{ $js.RelPermalink }}" defer></script>
  {{ end }}
</article>
{{ end }}